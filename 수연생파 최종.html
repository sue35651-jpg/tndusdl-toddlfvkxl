<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒ‰ â†’ ë™ì‘ ë°˜ì‘ ê²Œì„ (ë£°ë ›)</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Malgun Gothic', sans-serif;
  overflow: hidden;
  width: 100vw;
  height: 100vh;
}

.screen {
  display: none;
  width: 100%;
  height: 100%;
  position: relative;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.screen.active {
  display: flex;
}

.btn {
  min-width: 200px;
  min-height: 80px;
  font-size: 32px;
  font-weight: bold;
  border: 3px solid #333;
  border-radius: 10px;
  cursor: pointer;
  margin: 10px;
  transition: transform 0.1s;
  background: white;
}

.btn:hover {
  transform: scale(1.05);
}

.btn:active {
  transform: scale(0.98);
}

.back-btn {
  position: absolute;
  left: 20px;
  bottom: 20px;
  min-width: 150px;
  min-height: 60px;
  font-size: 24px;
  background: #f0f0f0;
}

.top-right-controls {
  position: absolute;
  right: 10px;
  top: 10px;
  display: flex;
  gap: 10px;
  z-index: 1000;
}

.small-btn {
  min-width: 60px;
  min-height: 40px;
  font-size: 16px;
  background: rgba(255,255,255,0.9);
  border: 2px solid #333;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: transform 0.1s;
}

.small-btn:hover {
  transform: scale(1.05);
  background: rgba(255,255,255,1);
}

.small-btn.roulette-active {
  background: rgba(255,215,0,0.9);
  border-color: #ff6600;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.difficulty-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  max-width: 600px;
}

.color-selector {
  display: flex;
  gap: 15px;
  margin: 20px 0;
}

.color-btn {
  width: 120px;
  height: 120px;
  border: 4px solid #333;
  border-radius: 10px;
  cursor: pointer;
  font-size: 24px;
  font-weight: bold;
  transition: transform 0.1s;
}

.color-btn.selected {
  border: 8px solid #000;
  transform: scale(1.1);
}

.color-boxes {
  display: flex;
  gap: 30px;
  margin: 30px 0;
}

.color-box {
  width: 150px;
  height: 150px;
  border: 5px solid #000;
  background: white;
  border-radius: 10px;
}

.game-screen {
  transition: background-color 0.1s ease;
  cursor: pointer;
}

h1 {
  font-size: 64px;
  margin-bottom: 40px;
  text-align: center;
}

h2 {
  font-size: 48px;
  margin-bottom: 30px;
  text-align: center;
}

.info-text {
  font-size: 28px;
  margin: 20px 0;
  text-align: center;
}
</style>
</head>
<body>

<div id="startScreen" class="screen active">
  <h1>ìƒ‰ â†’ ë™ì‘ ë°˜ì‘ ê²Œì„</h1>
  <button class="btn" onclick="showDifficultyScreen()">ê²Œì„ ì‹œì‘</button>
  <div class="top-right-controls">
    <button class="small-btn" onclick="toggleFullscreen()">ğŸ”²</button>
  </div>
</div>

<div id="difficultyScreen" class="screen">
  <h2>ë‚œì´ë„ ì„ íƒ</h2>
  <div class="difficulty-grid">
    <button class="btn" onclick="selectDifficulty(1)">ë‚œì´ë„ 1<br><span style="font-size:20px;">10ê°€ì§€ ìƒ‰ ê· ë“±</span></button>
    <button class="btn" onclick="selectDifficulty(2)">ë‚œì´ë„ 2<br><span style="font-size:20px;">ì£¼ìš” ìƒ‰ 1ê°œ ì„ íƒ</span></button>
    <button class="btn" onclick="selectDifficulty(3)">ë‚œì´ë„ 3<br><span style="font-size:20px;">ì£¼ìš” ìƒ‰ 2ê°œ ì„ íƒ</span></button>
    <button class="btn" onclick="selectDifficulty(4)">ë‚œì´ë„ 4<br><span style="font-size:20px;">3ê°€ì§€ ìƒ‰ ì§‘ì¤‘</span></button>
  </div>
  <button class="btn back-btn" onclick="showStartScreen()">â† ë’¤ë¡œê°€ê¸°</button>
  <div class="top-right-controls">
    <button class="small-btn" onclick="toggleFullscreen()">ğŸ”²</button>
  </div>
</div>

<div id="difficulty2Screen" class="screen">
  <h2>ì£¼ìš” ìƒ‰ 1ê°œ ì„ íƒ</h2>
  <p class="info-text">ì„ íƒí•œ ìƒ‰ì´ 30% í™•ë¥ ë¡œ ë“±ì¥í•©ë‹ˆë‹¤</p>
  <div class="color-selector">
    <button class="color-btn" style="background:#FF0000;color:white;" onclick="selectMainColor(0, 2)">ë¹¨ê°•</button>
    <button class="color-btn" style="background:#0000FF;color:white;" onclick="selectMainColor(1, 2)">íŒŒë‘</button>
    <button class="color-btn" style="background:#FFD700;color:black;" onclick="selectMainColor(2, 2)">ë…¸ë‘</button>
  </div>
  <button class="btn" id="startBtn2" onclick="startGame()" style="display:none;">ê²Œì„ ì‹œì‘</button>
  <button class="btn back-btn" onclick="showDifficultyScreen()">â† ë’¤ë¡œê°€ê¸°</button>
  <div class="top-right-controls">
    <button class="small-btn" onclick="toggleFullscreen()">ğŸ”²</button>
  </div>
</div>

<div id="difficulty3Screen" class="screen">
  <h2>ì£¼ìš” ìƒ‰ 2ê°œ ì„ íƒ</h2>
  <p class="info-text">ì„ íƒí•œ ìƒ‰ë“¤ì´ ê°ê° 20% í™•ë¥ ë¡œ ë“±ì¥í•©ë‹ˆë‹¤</p>
  <div class="color-boxes">
    <div class="color-box" id="box1"></div>
    <div class="color-box" id="box2"></div>
  </div>
  <div class="color-selector">
    <button class="color-btn" style="background:#FF0000;color:white;" onclick="selectMainColor(0, 3)">ë¹¨ê°•</button>
    <button class="color-btn" style="background:#0000FF;color:white;" onclick="selectMainColor(1, 3)">íŒŒë‘</button>
    <button class="color-btn" style="background:#FFD700;color:black;" onclick="selectMainColor(2, 3)">ë…¸ë‘</button>
  </div>
  <button class="btn" id="startBtn3" onclick="startGame()" style="display:none;">ê²Œì„ ì‹œì‘</button>
  <button class="btn back-btn" onclick="showDifficultyScreen()">â† ë’¤ë¡œê°€ê¸°</button>
  <div class="top-right-controls">
    <button class="small-btn" onclick="toggleFullscreen()">ğŸ”²</button>
  </div>
</div>

<div id="gameScreen" class="screen game-screen" onclick="handleGameClick()">
  <div class="top-right-controls">
    <button class="small-btn" id="rouletteBtn" onclick="event.stopPropagation(); toggleRoulette()">ğŸ°</button>
    <button class="small-btn" onclick="event.stopPropagation(); showStartScreen()">ğŸ </button>
    <button class="small-btn" onclick="event.stopPropagation(); toggleFullscreen()">ğŸ”²</button>
  </div>
</div>

<script>
const colors = [
  { hex: '#FF0000', name: 'Red', freq: 262 },
  { hex: '#0000FF', name: 'Blue', freq: 330 },
  { hex: '#FFD700', name: 'Yellow', freq: 392 },
  { hex: '#00CC55', name: 'Green', freq: 440 },
  { hex: '#FF8C00', name: 'Orange', freq: 494 },
  { hex: '#800080', name: 'Purple', freq: 523 },
  { hex: '#00CED1', name: 'Cyan', freq: 587 },
  { hex: '#FF1493', name: 'Magenta', freq: 659 },
  { hex: '#8B4513', name: 'Brown', freq: 698 },
  { hex: '#4B0082', name: 'Indigo', freq: 784 }
];

let gameState = {
  difficulty: 0,
  currentRound: 0,
  selectedColors: [],
  weights: [],
  gameLog: [],
  lastKeyTime: 0,
  currentColorIndex: null,
  rouletteMode: false,
  rouletteInterval: null,
  rouletteRunning: false
};

let audioContext = null;

function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playTone(frequency, duration = 0.3) {
  initAudio();
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  oscillator.frequency.value = frequency;
  oscillator.type = 'sine';
  
  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
  
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + duration);
}

function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
}

function showStartScreen() {
  stopRoulette();
  gameState = { 
    difficulty: 0, 
    currentRound: 0, 
    selectedColors: [], 
    weights: [], 
    gameLog: [], 
    lastKeyTime: 0,
    currentColorIndex: null,
    rouletteMode: false,
    rouletteInterval: null,
    rouletteRunning: false
  };
  showScreen('startScreen');
}

function showDifficultyScreen() {
  showScreen('difficultyScreen');
}

function selectDifficulty(level) {
  gameState.difficulty = level;
  
  if (level === 1 || level === 4) {
    setupWeights();
    startGame();
  } else if (level === 2) {
    gameState.selectedColors = [];
    document.getElementById('startBtn2').style.display = 'none';
    document.querySelectorAll('#difficulty2Screen .color-btn').forEach(btn => btn.classList.remove('selected'));
    showScreen('difficulty2Screen');
  } else if (level === 3) {
    gameState.selectedColors = [];
    document.getElementById('box1').style.background = 'white';
    document.getElementById('box2').style.background = 'white';
    document.getElementById('startBtn3').style.display = 'none';
    document.querySelectorAll('#difficulty3Screen .color-btn').forEach(btn => btn.classList.remove('selected'));
    showScreen('difficulty3Screen');
  }
}

function selectMainColor(colorIndex, difficulty) {
  const mainColors = [0, 1, 2];
  const selectedColorIndex = mainColors[colorIndex];
  
  if (difficulty === 2) {
    gameState.selectedColors = [selectedColorIndex];
    document.querySelectorAll('#difficulty2Screen .color-btn').forEach((btn, i) => {
      btn.classList.toggle('selected', i === colorIndex);
    });
    document.getElementById('startBtn2').style.display = 'block';
  } else if (difficulty === 3) {
    if (gameState.selectedColors.includes(selectedColorIndex)) {
      return;
    }
    
    gameState.selectedColors.push(selectedColorIndex);
    
    const boxId = gameState.selectedColors.length === 1 ? 'box1' : 'box2';
    document.getElementById(boxId).style.background = colors[selectedColorIndex].hex;
    
    if (gameState.selectedColors.length === 2) {
      document.getElementById('startBtn3').style.display = 'block';
    }
  }
}

function setupWeights() {
  const weights = new Array(10).fill(0);
  
  if (gameState.difficulty === 1) {
    weights.fill(1);
  } else if (gameState.difficulty === 2) {
    const mainColor = gameState.selectedColors[0];
    weights.fill(70 / 9);
    weights[mainColor] = 30;
  } else if (gameState.difficulty === 3) {
    weights.fill(60 / 8);
    gameState.selectedColors.forEach(idx => {
      weights[idx] = 20;
    });
  } else if (gameState.difficulty === 4) {
    weights.fill(50 / 7);
    weights[0] = 50 / 3;
    weights[1] = 50 / 3;
    weights[2] = 50 / 3;
  }
  
  gameState.weights = weights;
}

function weightedRandomChoice() {
  const totalWeight = gameState.weights.reduce((a, b) => a + b, 0);
  let random = Math.random() * totalWeight;
  
  for (let i = 0; i < gameState.weights.length; i++) {
    random -= gameState.weights[i];
    if (random <= 0) {
      return i;
    }
  }
  return 0;
}

function startGame() {
  setupWeights();
  gameState.currentRound = 0;
  gameState.gameLog = [];
  gameState.currentColorIndex = null;
  gameState.rouletteMode = false;
  
  if (gameState.difficulty === 1) {
    gameState.mustInclude = [0, 1, 2];
    gameState.includedColors = [];
  }
  
  showScreen('gameScreen');
  updateGameScreen(null);
  
  console.log('ê²Œì„ ì‹œì‘ - ë‚œì´ë„:', gameState.difficulty);
  console.log('ê°€ì¤‘ì¹˜:', gameState.weights);
}

function updateGameScreen(colorIndex) {
  const gameScreen = document.getElementById('gameScreen');
  
  if (colorIndex === null) {
    gameScreen.style.background = '#f0f0f0';
  } else {
    const color = colors[colorIndex];
    gameScreen.style.background = color.hex;
    gameState.currentColorIndex = colorIndex;
    
    playTone(color.freq);
    
    gameState.gameLog.push({
      round: gameState.currentRound,
      color: color.name,
      hex: color.hex,
      timestamp: Date.now()
    });
    
    console.log(`Round ${gameState.currentRound}: ${color.name} (${color.hex})`);
  }
}

function toggleRoulette() {
  gameState.rouletteMode = !gameState.rouletteMode;
  const rouletteBtn = document.getElementById('rouletteBtn');
  
  if (gameState.rouletteMode) {
    rouletteBtn.classList.add('roulette-active');
    gameState.rouletteRunning = true;
    startRoulette();
  } else {
    rouletteBtn.classList.remove('roulette-active');
    gameState.rouletteRunning = false;
    stopRoulette();
  }
}

function startRoulette() {
  stopRoulette();
  gameState.rouletteInterval = setInterval(() => {
    gameState.currentRound++;
    let colorIndex = weightedRandomChoice();
    
    if (gameState.difficulty === 1 && gameState.currentRound <= 10) {
      const missing = gameState.mustInclude.filter(c => !gameState.includedColors.includes(c));
      if (missing.length > 0 && gameState.currentRound === 10) {
        colorIndex = missing[Math.floor(Math.random() * missing.length)];
      }
      
      if (gameState.mustInclude.includes(colorIndex)) {
        if (!gameState.includedColors.includes(colorIndex)) {
          gameState.includedColors.push(colorIndex);
        }
      }
    }
    
    updateGameScreen(colorIndex);
  }, 300);
}

function stopRoulette() {
  if (gameState.rouletteInterval) {
    clearInterval(gameState.rouletteInterval);
    gameState.rouletteInterval = null;
  }
}

function handleGameClick() {
  if (gameState.rouletteMode) {
    if (gameState.rouletteRunning) {
      // ë£°ë ›ì´ ëŒì•„ê°€ëŠ” ì¤‘ì´ë©´ ë©ˆì¶¤
      stopRoulette();
      gameState.rouletteRunning = false;
    } else {
      // ë£°ë ›ì´ ë©ˆì¶°ìˆìœ¼ë©´ ì¬ê°œ
      startRoulette();
      gameState.rouletteRunning = true;
    }
  } else {
    nextSlide();
  }
}

function nextSlide() {
  const now = Date.now();
  if (now - gameState.lastKeyTime < 200) {
    return;
  }
  gameState.lastKeyTime = now;
  
  gameState.currentRound++;
  
  let colorIndex = weightedRandomChoice();
  
  if (gameState.difficulty === 1 && gameState.currentRound <= 10) {
    const missing = gameState.mustInclude.filter(c => !gameState.includedColors.includes(c));
    if (missing.length > 0 && gameState.currentRound === 10) {
      colorIndex = missing[Math.floor(Math.random() * missing.length)];
    }
    
    if (gameState.mustInclude.includes(colorIndex)) {
      if (!gameState.includedColors.includes(colorIndex)) {
        gameState.includedColors.push(colorIndex);
      }
    }
  }
  
  updateGameScreen(colorIndex);
}

document.addEventListener('keydown', function(e) {
  if ((e.key === 'Enter' || e.key === ' ') && document.getElementById('gameScreen').classList.contains('active')) {
    e.preventDefault();
    handleGameClick();
  }
});

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.log('ì „ì²´í™”ë©´ ì˜¤ë¥˜:', err);
    });
  } else {
    document.exitFullscreen();
  }
}
</script>

</body>
</html>